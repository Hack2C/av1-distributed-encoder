version: '3.8'

services:
  worker:
    image: ghcr.io/hack2c/av1-distributed-encoder:latest
    container_name: av1-worker-windows
    restart: unless-stopped
    command: python3 worker_client.py http://MASTER_IP_HERE:8090
    volumes:
      - ./worker-data:/data
      - worker-temp:/tmp/av1_transcoding
    environment:
      - PYTHONUNBUFFERED=1
      - MEDIA_DIRS=
      - FILE_DISTRIBUTION_MODE=true
      - TEMP_DIR=/tmp/av1_transcoding
      - TESTING_MODE=true
      - SVT_AV1_PRESET=0
      - PUID=1000
      - PGID=1000
    cap_add:
      - SYS_ADMIN
    devices:
      - /dev/fuse
    privileged: true

volumes:
  worker-temp:
